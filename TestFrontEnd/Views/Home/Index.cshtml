@{
    ViewBag.Title = "Home Page";
}

<script>
    const baseURL = 'http://localhost:64160';
    const client = new XMLHttpRequest()

    // Get multi-part response
    client.open('GET', baseURL + '/MultiPart', true)
    client.onreadystatechange = function () {
        if (client.readyState == 4) {
            const boundary = client.getResponseHeader('Content-Type').match(/boundary="(.+)"$/i)[1]

            // Break the response into an array of seperate parts
            var parts = parseMultipartBody(client.responseText, boundary);

            // Handle each part
            for (var x = 0; x < parts.length; ++x) {
                // HTML Document or Fragment
                if (parts[x].headers["content-type"] == "text/plain") {
                    handleBody(parts[x]);
                }
                // CSS Stylesheet or file reference
                if (parts[x].headers["content-type"] == "text/css") {
                    handleCss(parts[x]);
                }
                // Scripts
                if (parts[x].headers["content-type"] == "text/javascript") {
                    handleJs(parts[x]);
                }
            }
        }
    }
    client.send();

    function parseMultipartBody(body, boundary) {
        return body.split(`--${boundary}`).reduce((parts, part) => {
            if (part && part.trim().length > 0 && part.trim() !== '--') {
                const [head, body] = part.trim().split(/\r\n\r\n/g)
                parts.push({
                    body: body,
                    headers: head.split(/\r\n/g).reduce((headers, header) => {
                        const [key, value] = header.split(/:\s+/)
                        headers[key.toLowerCase()] = value
                        return headers
                    }, {})
                })
            }
            return parts
        }, [])
    }

    function handleBody(result) {
        var newDiv = document.createElement('div');
        newDiv.className = "PingYo-Block";
        newDiv.innerHTML = result.body;

        document.getElementsByTagName("body")[0].appendChild(newDiv);
    }

    function handleCss(result) {

        //  This Block is if we return the CSS url in the multipart message
        /*
        var fileref = document.createElement("link");
        fileref.rel = "stylesheet";
        fileref.type = "text/css";
        fileref.href = baseURL + result.body;
        document.getElementsByTagName("head")[0].appendChild(fileref);
        */
        //  This Block is if we return the CSS data directly in the multipart message
        var newStyle = document.createElement('style');
        newStyle.innerHTML = result.body;
        newStyle.setAttribute('type', 'text/css');
        document.getElementsByTagName("head")[0].appendChild(newStyle);

    }

    function handleJs(result) {
        var newScript = document.createElement('script');
        newScript.innerHTML = result.body;
        document.getElementsByTagName("body")[0].appendChild(newScript);
    }
</script>

<div class="jumbotron">
    <h1>ASP.NET</h1>
    <p class="lead">ASP.NET is a free web framework for building great Web sites and Web applications using HTML, CSS and JavaScript.</p>
    <p><a href="https://asp.net" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>

<div class="row">
    <div class="col-md-4">
        <h2>Getting started</h2>
        <p>
            ASP.NET MVC gives you a powerful, patterns-based way to build dynamic websites that
            enables a clean separation of concerns and gives you full control over markup
            for enjoyable, agile development.
        </p>
        <p><a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkId=301865">Learn more &raquo;</a></p>
    </div>
    <div class="col-md-4">
        <h2>Get more libraries</h2>
        <p>NuGet is a free Visual Studio extension that makes it easy to add, remove, and update libraries and tools in Visual Studio projects.</p>
        <p><a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkId=301866">Learn more &raquo;</a></p>
    </div>
    <div class="col-md-4">
        <h2>Web Hosting</h2>
        <p>You can easily find a web hosting company that offers the right mix of features and price for your applications.</p>
        <p><a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkId=301867">Learn more &raquo;</a></p>
    </div>
</div>